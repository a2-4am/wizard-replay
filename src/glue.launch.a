;license:MIT
;(c) 2023 by 4am
;
; glue code to launch games
;
; Public functions
; - Launch
;

VolNamesLo
         !byte <sVolProvingGrounds
         !byte <sVolKnightOfDiamonds
         !byte <sVolLegacyOfLlylgamyn
         !byte <sVolNihonbashi
         !byte <sVolOConnor
         !byte <sVolVlad
         !byte <sVolEmperor
         !byte <sVolBrotherhood

VolNamesHi
         !byte >sVolProvingGrounds
         !byte >sVolKnightOfDiamonds
         !byte >sVolLegacyOfLlylgamyn
         !byte >sVolNihonbashi
         !byte >sVolOConnor
         !byte >sVolVlad
         !byte >sVolEmperor
         !byte >sVolBrotherhood

LoadersLo
         !byte <sLoader1
         !byte <sLoader2
         !byte <sLoader3
         !byte <sLoader1
         !byte <sLoader1
         !byte <sLoader1
         !byte <sLoader1
         !byte <sLoader1
LoadersHi
         !byte >sLoader1
         !byte >sLoader2
         !byte >sLoader3
         !byte >sLoader1
         !byte >sLoader1
         !byte >sLoader1
         !byte >sLoader1
         !byte >sLoader1

;------------------------------------------------------------------------------
; Launch
; load game and jump to it
; in:    SelectedIndex contains index of game to launch
;          (used a index into VolNamesLo/Hi and other arrays)
;------------------------------------------------------------------------------
Launch
         +LDADDR sGameDirectory
         jsr   SetPath

         ldx   SelectedIndex
         lda   VolNamesLo, x
         ldy   VolNamesHi, x
         jsr   AddToPath

         jsr   SetPrefix
         !word gPathname

         ldx   SelectedIndex
         lda   LoadersLo, x
         ldy   LoadersHi, x
         jsr   SetPath

         jsr   LoadFile1Shot
         !word gPathname             ; filename
         !word $0800                 ; load address
         !word $1400                 ; max size
         !word $1C00                 ; ProDOS file buffer address ($400 bytes)

         jsr   ROM_TEXT
         jsr   ROM_HOME
         jsr   ROM_NORMAL
         jsr   InstallBye
         jmp   $0800
